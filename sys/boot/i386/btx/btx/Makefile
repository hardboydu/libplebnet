# $FreeBSD$

PROG=	btx.out
INTERNALPROG=
NOMAN=
SRCS=	btx.S
CLEANFILES= btx

.if defined(PAGING)
CFLAGS+=-DPAGING
.endif

.if defined(BOOT_BTX_NOHANG)
BOOT_BTX_FLAGS=0x1
.else
BOOT_BTX_FLAGS=0x0
.endif

CFLAGS+=-DBTX_FLAGS=${BOOT_BTX_FLAGS}

.if defined(BTX_SERIAL)
BOOT_COMCONSOLE_PORT?= 0x3f8
BOOT_COMCONSOLE_SPEED?= 9600
B2SIOFMT?=	0x3

CFLAGS+=-DBTX_SERIAL -DSIOPRT=${BOOT_COMCONSOLE_PORT} \
	-DSIOFMT=${B2SIOFMT} -DSIOSPD=${BOOT_COMCONSOLE_SPEED}
.endif

ORG=	0x9000

all: btx

LDFLAGS=-N -e start -Ttext ${ORG}

btx: btx.out
	objcopy -S -O binary btx.out ${.TARGET}

.include <bsd.prog.mk>

# ex:ts=8
#
# $Id: Makefile.inc,v 1.1 1998/08/27 08:09:38 obrien Exp $
#
# Makefile for amd
# 	This file is under a "BSD" copyright (c) by David O'Brien 1998.
#	Portions derived from
#	$NetBSD: Makefile.inc,v 1.10 1998/08/08 22:33:27 christos Exp $
#	Portions derived from amd/libamu/Makefile
#	$NetBSD: Makefile,v 1.8 1998/08/08 22:33:37 christos Exp $
#

#INCGEN!=	cd ${.CURDIR}/../include; \
#		printf 'xwhere: .MAKE\n\t@echo \$${.OBJDIR}\n' | ${MAKE} -s -f-

#CFLAGS+=	-I${INCGEN}
CFLAGS+=	-I. -I${.CURDIR} 
CFLAGS+=	-I${.CURDIR}/../include
CFLAGS+=	-I${.CURDIR}/../../../contrib/amd/include
CFLAGS+=	-I${.CURDIR}/../../../contrib/amd
CFLAGS+=	-DHAVE_CONFIG_H

LIBAMUDIR!=	cd ${.CURDIR}/../libamu; \
		printf 'xwhere: .MAKE\n\t@echo \$${.OBJDIR}\n' | ${MAKE} -Bs -f-
LIBAMU=		${LIBAMUDIR}/libamu.a


SRCS+=		config_local.h
CLEANFILES+=	config_local.h
config_local.h: ${.CURDIR}/../include/newvers.sh
	@rm -f ${.TARGET}
	sh ${.ALLSRC} > ${.TARGET}


RPCCOM=		rpcgen
MOUNT_X=	${DESTDIR}/usr/include/rpcsvc/mount.x
NFS_PROT_X=	${DESTDIR}/usr/include/rpcsvc/nfs_prot.x
#		These are generated at compile time
SRCS+=		mount.h nfs_prot.h
CLEANFILES+=	mount.h nfs_prot.h

mount.h: ${MOUNT_X}
	${RPCCOM} -h -DWANT_NFS3 ${MOUNT_X} -o ${.TARGET}

nfs_prot.h: ${NFS_PROT_X}
	${RPCCOM} -h ${NFS_PROT_X} -o ${.TARGET}


.if exists(${.CURDIR}/../../Makefile.inc)
.include "${.CURDIR}/../../Makefile.inc"
.endif

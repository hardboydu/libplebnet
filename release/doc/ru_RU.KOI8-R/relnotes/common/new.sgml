<!--
     The FreeBSD Russian Documentation Project

     $FreeBSDru: frdp/release/doc/ru_RU.KOI8-R/relnotes/common/new.sgml,v 1.23 2005/03/14 19:17:49 den Exp $

     Original revision: 1.823
-->

<articleinfo>
  <title>Информация о релизе &os;/&arch; &release.current;</title>

  <corpauthor>Проект &os;</corpauthor>

  <pubdate>$FreeBSD$</pubdate>

  <copyright>
    <year>2000</year>
    <year>2001</year>
    <year>2002</year>
    <year>2003</year>
    <year>2004</year>
    <year>2005</year>
    <holder role="mailto:doc@FreeBSD.org">Проект документирования &os;</holder>
  </copyright>

  <legalnotice id="trademarks" role="trademarks">
    &tm-attrib.freebsd;
    &tm-attrib.ibm;
    &tm-attrib.ieee;
    &tm-attrib.intel;
    &tm-attrib.sparc;
    &tm-attrib.general;
  </legalnotice>

  <abstract>
    <para>Заметки о релизе для &os; &release.current; содержат общую
      информацию по изменениям, внесенным в систему с момента создания
      &release.branch;.
      Этот документ содержит список сообщений безопасности, выпущенных после
      последнего релиза, а также список значительных изменений, внесенных
      в ядро и пользовательские программы &os;.  Представлены также
      краткие заметки по обновлению системы.</para>
  </abstract>
</articleinfo>

<sect1 id="intro">
  <title>Введение</title>

  <para>Этот документ содержит информацию о релизе &os;
    &release.current; для аппаратной платформы &arch.print;.
    В нем описаны недавно добавленные, измененные, или удаленные возможности
    &os;.  Он также представляет некоторые заметки по обновлению
    с предыдущей версии &os;.</para>

<![ %release.type.current [

  <para>Дистрибутив (&release.type;), для которого предоставлена эта
    информация, представляет собой последнюю точку на ветви разработки
    с момента создания &release.branch;.  Собранные бинарные дистрибутивы
    (&release.type;) из этой ветви можно найти на <ulink
    url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.snapshot [

  <para>Дистрибутив (&release.type;), для которого предоставлена эта
    информация, представляет собой точку на ветви разработки между
    &release.prev; и будущим релизом &release.next;.  Отдельные
    собранные бинарные дистрибутивы (&release.type;) из этой ветви
    можно найти на <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.release [

  <para>Этот дистрибутив &os; &release.current; представляет собой
    &release.type;.  Его можно найти на <ulink
    url="&release.url;"></ulink> или на любом из зеркал.  Дополнительная
    информация по получению этого (или другого) &release.type;
    дистрибутива &os; может быть найдена в
    <ulink
    url="&url.books.handbook;/mirrors.html"
>приложении
    <quote>Получение &os;</quote></ulink> <ulink
    url="&url.books.handbook;/">Руководства
    &os;</ulink>.</para>

]]>

  <para>Всем пользователям рекомендуется ознакомиться с сообщениями о
    проблемах перед установкой &os;.  В этот документ вносятся
    самая последняя информация, полученная в позже в процессе выпуска релиза
    или после релиза.  Обычно в нем находятся информация о известных
    ошибках, сообщениях безопасности и исправления документации.
    Актуальную копию сообщений о проблемах для &os;
    &release.current; можно найти на веб сайте &os;.</para>

</sect1>

<sect1 id="new">
  <title>Что нового</title>

  <para>В этом разделе описаны
    основные видимые пользователю добавленные или измененные с
    &release.prev; возможности &os;.  Как правило, изменения, описанные
    здесь, уникальны для &release.branch;, если только они не помечены
    как &merged;.</para>

  <para>Обычно в информации о релизе последовательно включены
    последние сообщения безопасности, выпущенные после
    &release.prev.historic;, информация о поддержки новых драйверов или
    оборудования, новых команд или параметров, информация о основных
    исправлениях ошибок, или обновлениях стороннего программного
    обеспечения.  В нем могут также перечисляться изменения важнейших
    портов/пакетов или практики выпуска релизов.  Конечно, в информацию о
    релизе не вносятся данные о каждом отдельном изменении, сделанном в
    &os; между релизами; этот документ фокусируется в основном на сообщениях
    безопасности, видимых пользователю изменениях, и основных архитектурных
    улучшениях.</para>

  <sect2 id="security">
    <title>Сообщения безопасности</title>

    <para>Была исправлена ошибка в утилите &man.fetch.1;, позволявшая
      злонамеренному HTTP серверу перезапись произвольных участков памяти
      клиента.  За дальнейшей информацией обращайтесь к сообщению безопасности
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:16.fetch.asc">FreeBSD-SA-04:16.fetch</ulink>.
      &merged;</para>

    <para>Была исправлена ошибка в &man.procfs.5; и &man.linprocfs.5;,
      позволявшая злонамеренному локальному пользователю читать части
      памяти ядра или выполнять локальную DoS атаку путем вызова паники
      системы.  За дальнейшей информацией обращайтесь к сообщению безопасности
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:17.procfs.asc">FreeBSD-SA-04:17.procfs</ulink>.
      &merged;</para>

  </sect2>

  <sect2 id="kernel">
    <title>Изменения в ядре</title>

    <para arch="i386">Поддержка процессоров 80386 (опция ядра
      <literal>I386_CPU</literal>) была удалена.  Пользователям,
      запускающим систему на этом классе CPU, предлагается использовать
      &os; 5.<replaceable>X</replaceable> или более раннюю.</para>

    <para>Отладчик ядра &man.ddb.4; теперь поддерживает команду
      <command>show alllocks</command>, которая выводит список процессов и
      потоков, удерживающих в данный момент sleep мьютексы (и spin мьютексы
      для текущего потока).  &merged;</para>

    <para>&man.jail.8; теперь поддерживает новую переменную sysctl
      <varname>security.jail.chflags_allowed</varname>, которая контролирует
      поведение &man.chflags.1; внутри jail.
      Если переменная установлена в <literal>0</literal> (значение по
      умолчанию), внутри jail <username>root</username> считается
      непривилегированным пользователем; если она установлена в
      <literal>1</literal>, различий между пользователем
      <username>root</username> внутри jail и вне jail не делается.
      &merged;</para>

    <para arch="alpha,amd64,i386">Переменная загрузчика
      <varname>debug.mpsafevm</varname> была включена по
      умолчанию.  &merged;</para>

    <para>Был добавлен &man.memguard.9;, выделитель памяти ядра,
      разработанный в качестве помощи для обнаружения сценариев
      <quote>tamper-after-free</quote>.  Он должен быть явно добавлен
      через <literal>options DEBUG_MEMGUARD</literal>, с небольшими
      изменениями ядра.  Он как в основном предназначен для использования
      разработчиками ядра.</para>

    <para>Множество ошибок было исправлено в планировщике ULE.
      &merged;</para>

    <para>Была добавлена fine-grained блокировка, чтобы позволить большей
      части стека VFS работать без Giant блокировки.  Она включена по
      умолчанию на архитектурах alpha, amd64 и i386, и может быть
      выключена установкой переменной загрузчика (и переменной
      sysctl) <varname>debug.mpsafevfs</varname> в
      <literal>0</literal>.</para>

    <para arch="i386">Была исправлена ошибка в обработке Inter-Processor
      Interrupt (IPI), которая могла вызвать крах SMP систем под высокой
      нагрузкой.  Более подробная информация опубликована в сообщении о
      проблеме
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ERRATA/notices/FreeBSD-EN-05:03.ipi.asc">FreeBSD-EN-05:03.ipi</ulink>.
      &merged;</para>

    <para>Объекты System V IPC (очереди сообщений, семафоры, и разделяемая
      память) теперь поддерживают политики принудительного контроля доступа
      (MAC) &man.mac.biba.4;, &man.mac.mls.4;, &man.mac.stub.4;, и
      &man.mac.test.4;.</para>

    <para arch="i386">Выделение памяти для старых PCI мостов было ограничено
      до 32MB RAM.  Многие старые мосты позволяют выделение памяти только
      из этого диапазона.  Изменение применяется только к устройствам,
      память которых не выделена BIOS.  Это изменение исправляет ошибку
      <quote>bad Vcc</quote> мостов CardBus (&man.pccbb.4;). &merged;</para>

    <para>&man.sysctl.3; MIB, начинающиеся с <quote>debug</quote>, теперь
      требуют параметр ядра <literal>options SYSCTL_DEBUG</literal>.
      Этот параметр выключен по умолчанию.</para>

    <para>Был добавлен общий драйвер интерфейса &man.tty.4; и многие
      драйвера устройств, включая
      &man.cx.4; (<literal>{tty,cua}x</literal>),
      &man.cy.4; (<literal>{tty,cua}c</literal>),
      &man.digi.4; (<literal>{tty,cua}D</literal>),
      &man.rc.4; (<literal>{tty,cua}m</literal>),
      &man.rp.4; (<literal>{tty,cua}R</literal>),
      &man.sab.4; (<literal>{tty,cua}z</literal>),
      &man.si.4; (<literal>{tty,cua}A</literal>),
      &man.sio.4; (<literal>{tty,cua}d</literal>),
      sx (<literal>{tty,cua}G</literal>),
      &man.uart.4; (<literal>{tty,cua}u</literal>),
      &man.ubser.4; (<literal>{tty,cua}y</literal>),
      &man.ucom.4; (<literal>{tty,cua}U</literal>) и
      &man.ucycom.4; (<literal>{tty,cua}y</literal>)
      были переписаны для его использования.  Обратите
      внимание, что файлы <filename>/etc/remote</filename>
      и <filename>/etc/ttys</filename> также были обновлены.</para>

    <para>Был добавлен драйвер &man.vkbd.4;.  Этот драйвер
      предоставляет программный loopback механизм, который позволяет
      реализовать виртуальную клавиатуру AT подобно тому, как драйвер
      &man.pty.4; делает это для терминалов.</para>

    <!-- Above this line, sort kernel changes by manpage/keyword-->

    <para arch="i386,amd64,ia64">Параметр по умолчанию <varname>HZ</varname>
      (контролирующий различные таймеры ядра) был увеличен с
      <literal>100</literal> до <literal>1000</literal>
      на i386 и ia64.  Он был уменьшен с
      <literal>1024</literal> до <literal>1000</literal> на amd64
      для уменьшения эффектов синхронизации с другими системными
      часами.</para>

    <para>Максимальная длина команд shell была изменена с 128 байт
      до <varname>PAGE_SIZE</varname>.  По умолчанию, это значение
      или 4KB (i386, pc98, amd64 и powerpc) или 8KB (sparc64
      и ia64).  В результате, модули совместимости необходимо
      пересобрать для поддержания синхронизации с
      ядром.</para>

    <sect3 id="boot">
      <title>Изменения в загрузчике</title>

      <para arch="i386">Добавлена версия <filename>boot0</filename> для
	последовательной консоли.  Она может быть записана на диск с
	использованием &man.boot0cfg.8; и указанием
	<filename>/boot/boot0sio</filename> в качестве аргумента
	к параметру <option>-b</option>.</para>

      <para arch="i386"><filename>cdboot</filename> теперь обходит проблему
	BIOS, встречающуюся на некоторых системах при загрузке с USB
	CDROM приводов.</para>

      <para>Команда загрузчика <command>autoboot</command> теперь
	поддерживает параметр prompt.</para>

      <para>Был добавлен параметр меню загрузчика для установки
	<varname>hint.atkbd.0.flags=0x1</varname>.  Это позволяет
	клавиатуре USB работать если нет подключенной клавиатуры
	PS/2.</para>

      <para>Логотип был убран из загрузочного меню.</para>

      <!-- Above this line, order boot loader changes by keyword-->

    </sect3>

    <sect3 id="proc">
      <title>Поддержка оборудования</title>

      <para arch="i386,amd64">Драйвер &man.acpi.4; выключает
	устройства ACPI и PCI или переводит их в режим пониженного
	энергопотребления в режиме suspend, и возвращает обратно
	при восстановлении.  Это поведение может быть заблокировано установкой
	переменных sysctl <varname>debug.acpi.do_powerstate</varname>
	и <varname>hw.pci.do_powerstate</varname> в <literal>0</literal>.</para>

      <para arch="i386,amd64">Был добавлен драйвер acpi_ibm для
	лэптопов IBM.</para>

      <para arch="i386,amd64">Был добавлен драйвер acpi_snc,
	поддерживающий Sony Notebook Controller на различных лэптопах
	Sony.</para>

      <para arch="sparc64">Был добавлен драйвер &man.auxio.4; для обработки
	некоторых вспомогательных функций ввода/вывода, обнаруженных
	в различных SBus/EBus &ultrasparc; моделях. &merged;</para>

      <para>Была добавлена инфраструктура для гибкого управления
	скоростью процессора.  Она предоставляет различным драйверам
	методы управления энергопотреблением CPU путем изменения
	скорости процессора.  Более детальная информация находится
	на странице справочника &man.cpufreq.4;. &merged;
	В настоящее время поддерживаются драйверы ichss (Intel SpeedStep
	for ICH), acpi_perf (ACPI CPU performance states), и
	acpi_throttle (ACPI CPU throttling).  Последние два драйвера
	включены в драйвер &man.acpi.4;.  Поддерживаемые драйверы
	могут быть индивидуально отключены путем установки хинтов,
	таких как <varname>hint.<replaceable>ichss</replaceable>.0.disabled="1"</varname>.</para>

      <para arch="i386">Поддержка подсистемы OLDCARD была удалена.
	Для поддержки всех устройств PCCARD в настоящее время
	используется NEWCARD.</para>

      <para>Был добавлен драйвер pcii для поддержки карт GPIB-PCIIA
	IEEE-488. &merged;</para>

      <para>Драйвер &man.atkbd.4; теперь поддерживает флаг
	<literal>0x8</literal> (bit 3) для отмены тестирования порта
	клавиатуры во время тестирования устройств, поскольку
	оно вызывало сбой в некоторых системах, например на
	Compaq R3000Z series лэптопах amd64.</para>

      <para arch="i386">Был добавлен драйвер &man.pbio.4;, поддерживающий
	прямой доступ к Intel 8255A programmable peripheral interface (PPI)
	в режиме 0 (простой ввод/вывод).</para>

      <para>Драйвер &man.psm.4; теперь лучше подходит для пользователей
	Synaptics Touchpad.  Теперь он лучше отслеживает низкоскоростные
	перемещения и поддерживает различные дополнительные кнопки.<!--dials?-->
	Эти возможности могут быть настроены с помощью иерархии sysctl
	<varname>hw.psm.synaptics.<replaceable>*</replaceable></varname>.</para>

      <para arch="sparc64">Был добавлен драйвер rtc для поддержки
	MC146818-совместимых часов, обнаруженных на некоторых моделях
	&ultrasparc; II и III. &merged;</para>

      <para arch="sparc64">Драйвер &man.uart.4; был включен в ядре
	<filename>GENERIC</filename>, и теперь это драйвер по умолчанию
	для последовательных портов.  Драйверы ofw_console и
	&man.sab.4; теперь выключены в ядре
	<filename>GENERIC</filename>. &merged;</para>

      <para>Драйвер &man.uplcom.4; теперь поддерживает обработку сигнала
	<literal>CTS</literal>.</para>

      <para>Был улучшен драйвер &man.ehci.4;.</para>

      <para arch="sparc64">Драйвер zs был удален, вместо него должен
	использоваться драйвер &man.uart.4;.</para>

      <sect4 id="mm">
	<title>Поддержка мультимедиа</title>

	<para arch="sparc64">Был добавлен драйвер &man.snd.audiocs.4; для
	  поддержки Crystal Semiconductor CS4231 аудио контроллера,
	  обнаруженного на рабочих станциях &ultrasparc;. &merged;</para>

	<para>Драйвер &man.uaudio.4; теперь содержит некоторую дополнительную
	  функциональность, включая контроль уровня на большем числе входов
	  и возможность записи на некоторых устройствах.</para>

      </sect4>

      <sect4 id="net-if">
	<title>Поддержка сетевых интерфейсов</title>

	<para>Драйвер &man.ath.4; был обновлен, чтобы выделить алгоритм
	  контроля скорости передачи данных в отдельный модуль.
	  При использовании драйвера &man.ath.4; в файл конфигурации
	  ядра необходимо включить либо
	  <literal>device ath_rate_onoe</literal> либо
	  <literal>device ath_rate_amrr</literal>.</para>

	<para>Драйвер &man.bge.4; теперь поддерживает инфраструктуру
	  &man.altq.4;.</para>

	<para>Драйвер &man.cp.4; теперь MPSAFE. &merged;</para>

	<para>Драйвер &man.ctau.4; теперь MPSAFE. &merged;</para>

	<para>Драйвер &man.cx.4; теперь MPSAFE. &merged;</para>

	<para>Драйвер &man.dc.4; теперь поддерживает инфраструктуру
          &man.altq.4;.</para>

	<para>Драйвер &man.ed.4; теперь поддерживает инфраструктуру
          &man.altq.4;.  &merged;</para>

	<para>В драйвере &man.em.4; была выключена по умолчанию
	  аппаратная поддержка тегов VLAN, поскольку эта функция
	  конфликтовала с promiscuous режимом. &merged;</para>

	<para>Контроль потока Ethernet отключен по умолчанию в драйвере
	  &man.fxp.4; для предотвращения проблем &mdash; паники ядра.
	  <!--or is left in the kernel debugger. -->&merged;</para>

	<para>Драйвер gx(4) был удален, поскольку он не поддерживается
	  достаточно активно, и драйвер &man.em.4; поддерживает все
	  поддерживаемое им оборудование.</para>

	<para>Драйвер &man.hme.4; теперь MPSAFE. &merged;</para>

	<para arch="amd64">Конвертер драйверов устройств &man.ndis.4;
	  теперь поддерживает бинарные файлы &windows;/x86-64 на системах
	  amd64. &merged;</para>

	<para>Драйвер &man.sf.4; теперь поддерживает device polling и
	  &man.altq.4;. &merged;</para>

	<para>Были исправлены несколько программных ошибок в драйвере
	  &man.sk.4;.  Эти ошибки проявлялись на SMP системах,
	  и могли приводить к панике, ошибкам page fault, обрыву соединений
	  SSH или ошибкам при передаче файлов.  Более подробная
	  информация находится в сообщении о проблеме
	  <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ERRATA/notices/FreeBSD-EN-05:02.sk.asc">FreeBSD-EN-05:02.sk</ulink>.
	  &merged;</para>

	<para>Драйвер &man.sk.4; теперь поддерживает &man.altq.4;.
	  Этот драйвер также поддерживает jumbo фреймы на Yukon-based
	  интерфейсах. &merged;</para>

	<para>Драйвер &man.vge.4; теперь поддерживает device polling
	  (&man.polling.4;).</para>

	<para>Поддержка устройств 802.11 инфраструктурой &man.wlan.4;
	  тщательно пересмотрена.  В дополнение к архитектурным изменениям,
	  реализована полная поддержка 802.11g, WPA, 802.11i, 802.1x,
	  WME/WMM, AP-side power-saving, и инфраструктура плагинов для
	  криптографических модулей, аутентификаторов и контроля доступа.
	  Обратите внимание, что для WEP, в частности, необходима загрузка
	  (или компиляция) модуля <filename>wlan_wep</filename>
	  в ядро.</para>

      </sect4>
    </sect3>

    <sect3 id="net-proto">
      <title>Сетевые протоколы</title>

      <para>MTU feedback в IPv6 выключается при отправке данных,
	которые должны быть фрагментированы.  &merged;</para>

      <para>Был реализован Common Address Redundancy Protocol (CARP).
	CARP был взят из OpenBSD и позволяет нескольким хостам
	совместно использовать один IP адрес, чтобы обеспечивать
	высокую доступность и распределение нагрузки.
	За дальнейшей информацией обращайтесь к странице справочник
	&man.carp.4;.</para>

      <para>Параметр &man.ipfw.4; <literal>IPDIVERT</literal> теперь
	доступен в виде загружаемого модуля ядра.  Если этот модуль
	не загружен, &man.ipfw.4; не будет загружать правила
	<literal>divert</literal> и &man.natd.8; будет возвращать
	сообщение об ошибке <quote>protocol not supported</quote>.</para>

      <para>Система &man.ipfw.4; может работать с
	<varname>debug.mpsafenet</varname>=<literal>1</literal>
	(эта переменная равна <literal>1</literal> по умолчанию)
	когда используются параметры правил <literal>gid</literal>,
	<literal>jail</literal>, и/или <literal>uid</literal>.  &merged;</para>

      <para>&man.ipfw.8; теперь поддерживает классификацию и теги
	пакетов &man.altq.4; через divert сокет, а также
	TCP data length.</para>

      <para>Правило &man.ipfw.8; <literal>ipfw fwd</literal> теперь
	поддерживает полное управление назначением пакета при
	установке параметра ядра
	<literal>options IPFIREWALL_FORWARD_EXTENDED</literal> в дополнение
	к параметру <literal>options IPFIRWALL_FORWARD</literal>.
	Этот параметр ядра устраняет все ограничения для локально созданных
	пакетов и позволяет перенаправление пакетов, предназначенных для
	локально сконфигурированного IP адреса.
	Обратите внимание, что правила &man.ipfw.8; должны быть составлены
	аккуратно, чтобы, например, не нарушить	определение PMTU.
	&merged;</para>

      <para>&man.ipnat.8; теперь позволяет определять правила
	перенаправления для не-TCP/UDP пакетов.  &merged;</para>

      <para>Продолжается работа по уменьшению использования
	Giant блокировки стеком сетевых протоколов и улучшению
	стратегии блокировки.</para>

      <para>Новый узел NetGraph &man.ng.ipfw.4; предоставляет
	простой интерфейс между &man.ipfw.4; и &man.netgraph.4;.</para>

      <para>Новый узел NetGraph &man.ng.netflow.4; позволяет
	маршрутизатору, работающему под &os;, выполнять экспорт
	NetFlow версии 5. &merged;</para>

      <para>Драйвер &man.sppp.4; теперь включает поддержку Frame Relay
	&merged;</para>

      <para>Драйвер &man.sppp.4; теперь MPSAFE.</para>

      <para>Была исправлена ошибка TCP, которая иногда приводила к
	игнорированию пакетов RST при окне приема в ноль байт.
	&merged;</para>

      <para>Обработка <literal>RST</literal> в стеке
	TCP &os; была улучшена, чтобы максимально усложнить
	проведение reset атак при сохранении совместимости с
	широчайшим набором TCP стеков.  Алгоритм работает следующим
	образом:  Для соединений в состоянии <literal>ESTABLISHED</literal>
	только сброс с номерами последовательности, точно соответствующими
	<varname>last_ack_sent</varname> вызовут сброс: все
	другие сегменты будут отброшены.  Для соединений в
	любых других состояниях, сброс в любом месте окна приведет
	к сбросу соединения.  Все другие сегменты будут отброшены.
	Обратите внимание, что это нарушает спецификацию
	RFC 793: вы можете использовать обычное (но менее безопасное)
	поведение, установив новую переменную sysctl
	<varname>net.inet.tcp.insecure_rst</varname> в
	<literal>1</literal>.  &merged;</para>

      <para>Были исправлены несколько ошибок в реализации TCP
	SACK. &merged;</para>

      <para>Поддержка RFC 1644 T/TCP была удалена.  Реализация была
	основана на неполноценной модели безопасности, что облегчало
	проведение DoS атак.  Это расширение было признано
	дефективным в одном из последних документов
	Internet Draft.</para>

      <para>Реализация KAME IPv4 IPsec, интегрированная в
	&os;, теперь поддерживает TCP-MD5.  &merged;</para>

      <para>Алгоритм <quote>Random ephemeral port number allocation</quote>
	приводил к некоторым проблемам с повторным использованием
	портов при высокой частоте новых подключений.  Теперь
	в периоды, когда новые соединения создаются быстрее, чем
	<varname>net.inet.ip.portrange.randomcps</varname> в секунду,
	рандомизация номеров портов отключается на следующие
        <varname>net.inet.ip.portrange.randomtime</varname> секунд.
	Значения по умолчанию этих двух переменных sysctl равны
        <literal>10</literal> и <literal>45</literal> соответственно.
        &merged;</para>

      <para>Fine-grained блокировка была применена ко многим структурам
	данных в стеке протоколов IPX/SPX.  Хотя протокол и не полностью
	MPSAFE на данный момент, как правило можно безопасно использовать
	IPX/SPX без Giant блокировки (другими словами, переменная
	sysctl <varname>debug.mpsafenet</varname> может быть установлена
	в <literal>1</literal>).</para>

    </sect3>

    <sect3 id="disks">
      <title>Диски и устройства хранения</title>

      <para>Драйвер &man.amr.4; теперь может безопасно использоваться
	на системах с &man.pae.4;. &merged;</para>

      <para>Был добавлен класс SHSEC GEOM.  Он предоставлен для
	разделения секретного ключа (<quote>secret</quote>)
	между несколькими провайдерами GEOM.  Все эти провайдеры
	должны присутствовать, чтобы получить секретный ключ.
	Эта функция контролируется утилитой &man.gshsec.8;.
	&merged;</para>

      <para>Был добавлен драйвер &man.hptmv.4;, поддерживающий
	HighPoint RocketRAID 182x series. &merged;</para>

      <para>Драйвер &man.ips.4; теперь поддерживает дампы ядра на
	некоторых современных моделях ServeRAID.  &merged;</para>

      <para>Был удален драйвер &man.matcd.4;. &merged;</para>

      <para>При загрузке задержка по умолчанию для SCSI в ядре
	<filename>GENERIC</filename> была уменьшена с пятнадцати
	секунд до пяти секунд.</para>

      <para>Старая подсистема vinum(4) была удалена в пользу новой,
	основанной на &man.geom.4; версии.</para>

      <para arch="pc98">Драйвер &man.wd.4; был удален.  Было обнаружено,
	что драйвер &man.ata.4; работает достаточно хорошо на платформе
	pc98 и нет необходимости в использовании старого драйвера
	&man.wd.4;.</para>

      <para>Информация о вновь смонтированных файловых системах cd9660
	(например, информация о наличии расширений Rockridge) теперь
	печатается только если ядро было собрано в режиме verbose.
	Это изменение было сделано для уменьшения количества
	(зачастую ненужных) протоколируемых сообщений ядра. &merged;</para>

    </sect3>

    <sect3 id="fs">
      <title>Файловые системы</title>

      <para>Была добавлена файловая система autofs(9) и библиотека пользователя
	&man.libautofs.3;.</para>

      <para>Вычисление суммарной информации для не размонтированных
	корректно (<quote>dirty</quote>) файловых систем UFS и UFS2
	больше не выполняется во время загрузки, а делается фоновым
	&man.fsck.8;.  Это изменение увеличивает скорость загрузки при
	монтировании больших файловых систем после сбоя.  Предыдущее
	поведение может быть восстановлено установкой переменной sysctl
	<varname>vfs.ffs.compute_summary_at_mount</varname>
	в ненулевое значение.  &merged;</para>

      <para>Была исправлена ошибка NFS сервера, приводившая к панике ядра.
	Более подробная информация находится в сообщении о проблеме
	<ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ERRATA/notices/FreeBSD-EN-05:01.nfs.asc">FreeBSD-EN-05:01.nfs</ulink>.
	&merged;</para>

    </sect3>

    <sect3>
      <title>Стороннее программное обеспечение</title>

      <para><application>ACPI-CA</application> был обновлен с
	20040527 до 20041119. &merged;</para>

    </sect3>
  </sect2>

  <sect2 id="userland">
    <title>Изменения в программах пользователя</title>

    <para>Утилита &man.burncd.8; теперь позволяет задание команд,
      (таких как <command>eject</command>), выполняемых после
      выполнения команды fixate.</para>

    <para>Программа &man.ftpd.8; теперь корректно использует коды
      статуса <literal>212</literal> и <literal>213</literal>
      для каталога и файла (в предыдущей версии использовался
      код <literal>211</literal>).  Это поведение описано в
      RFC 959.  &merged;</para>

    <para>Команда <literal>create</literal> утилиты &man.gpt.8;
      теперь поддерживает параметр командной строки <option>-f</option>
      для форсирования создания GPT даже если на диске присутствует
      запись MBR. &merged;</para>

    <para>Функция &man.getaddrinfo.3; теперь запрашивает
      записи DNS <literal>A</literal> перед записями <literal>AAAA</literal>,
      когда указан <literal>AF_UNSPEC</literal>.  Некоторые
      DNS серверы некорректно возвращают <literal>NXDOMAIN</literal>
      в ответ на запрос несуществующей записи <literal>AAAA</literal>,
      хотя должны возвращать <literal>NOERROR</literal> с пустой
      записью.  Это проблема для двойного IPv4/IPv6 стека, поскольку
      после возврата <literal>NXDOMAIN</literal> на запрос
      <literal>AAAA</literal> приводит к тому, что запрашивающий сервер
      не пытается разрешить запись <literal>A</literal>.  Кроме того,
      такое поведение потенциально может привести к DoS атаке
      (см. <ulink url="http://www.kb.cert.org/vuls/id/714121"></ulink>
      с более подробной информацией).
      Обратите внимание, что хотя порядок запроса был изменен, возвращаемый
      результат все еще включает запись <literal>AF_INET6</literal>
      перед записью <literal>AF_INET</literal>.  &merged;</para>

    <para>Утилита gvinum(8) теперь поддерживает субкоманды
      <command>checkparity</command>,
      <command>rebuildparity</command> и
      <command>setstate</command>.  &merged;</para>

    <para>Утилита &man.ifconfig.8; была реконструирована.  Теперь она
      модульная и гибкая, уделено внимание поддержки специфичной
      для отдельных интерфейсов функциональности.  Поддержка 802.11
      была обновлена с учетом последних изменений в подсистеме и
      драйверах 802.11.</para>

    <para>Поддержка сокращенных форм нескольких параметров &man.ipfw.8;
      была исключена из числе рекомендованных.  При обнаружении одного
      из таких сокращений, на stderr печатается предупреждение, содержащее
      корректную полную форму.</para>

    <para>Дисковый формат файлов <literal>LC_CTYPE</literal> был изменен
      к машино-независимому виду.</para>

    <para>Библиотека <filename>libarchive</filename> (как и команда
      &man.tar.1;, ее использующая) теперь поддерживает чтение образов
      ISO (с опциональным расширением RockRidge) и архивов ZIP
      (со сжатием <literal>deflate</literal> и <literal>none</literal>).
      &merged;</para>

    <para>Была добавлена библиотека <filename>libgpib</filename>,
      чтобы предоставить доступ уровня пользователя к устройствам
      GPIB (используя драйвер pcii) через
      <function>ib<replaceable>foo</replaceable></function>
      API &merged;.</para>

    <para>Размер стека по умолчанию в <filename>libpthread</filename>
      и <filename>libc_r</filename> был увеличен.  На 32-битных
      платформах, основной поток получает 2MB стек по умолчанию,
      а остальные потоки получают 1MB стек по умолчанию.  На
      64-битных платформах, размер стека по умолчанию 4MB и 2MB
      соответственно.</para>

    <para>Библиотека <filename>libxpg4</filename> была удалена,
      поскольку вся ее функциональность была давно внесена в
      <filename>libc</filename>.
      Все бинарные файлы, слинкованные с <filename>libxpg4</filename>,
      должны быть перекомпилированы, или необходимо использовать
      &man.libmap.conf.5;.  В базовой системе &os; таких бинарных файлов
      нет.</para>

    <para>Программа &man.lpd.8; теперь убеждается, что файл данных передан
      полностью перед началом печати, если он передается с какого-либо
      другого хоста.  Некоторые реализации &man.lpr.1; отправляют
      контрольный файл для задания печати перед отправкой соответствующих
      файлов данных, что может вызвать проблемы, если получающий хост
      это нагруженный принт сервер.  &merged;</para>

    <para>В библиотеке &man.math.3; было реализовано множество новых
      функций.  В их число входят &man.ceill.3;,
      &man.floorl.3;, &man.ilogbl.3;, &man.fma.3; и варианты,
      &man.lrint.3; и варианты, и &man.lround.3; и
      варианты. &merged;</para>

    <para>Утилита &man.mknod.8; была исключена из числа поддерживаемых.
      Файлы устройств управляются файловой системой &man.devfs.5;
      начиная с &os; 5.0.</para>

    <para arch="i386">Была добавлена не-GPL утилита &man.mkuzip.8;,
      для сжатия образов файловых систем перед использованием
      с модулем <literal>GEOM_UZIP</literal> &man.geom.4;.
      &merged;</para>

    <para>Даемон &man.moused.8; теперь поддерживает <quote>виртуальную
      прокрутку</quote>, когда перемещения мыши при нажатой средней
      кнопке интерпретируются как прокрутка.  Эта функция включается
      флагом <option>-V</option>. &merged;</para>

    <para>Для динамических зон &man.named.8; был добавлен отдельный
      каталог, владельцем которого является пользователь
      <username>bind</username> (для создания журнального файла зоны).
      Более подробная информация находится в примере динамической
      зоны файла &man.named.conf.5;.  &merged;</para>

    <para>Утилита &man.ncal.1; теперь поддерживает флаг <option>-m</option>
      для создания календаря определенного месяца в текущем году.
      &merged;</para>

    <para>Утилита &man.newfs.8; теперь поддерживает флаг <option>-n</option>
      для подавления создания каталога <filename>.snap</filename>
      на новых файловых системах.  Эта функция предназначена для
      использования с файловыми системами в памяти или виртуальными
      файловыми системами, которым не требуется поддержка образов.
      &merged;</para>

    <para>Утилита &man.newfs.8; теперь выдает предупреждение при создании
      файловых систем UFS или UFS2, которые не могут поддерживать образы.
      Такая ситуация может возникать в случае очень больших файловых систем
      с блоками малого размера.  &merged;</para>

    <para>Утилита &man.newsyslog.8; теперь поддерживает параметр
      <option>-d</option> для изменения корневого каталога лог файлов
      подобно переменной <varname>DESTDIR</varname> для
      BSD make.  Эта переменная влияет только на пути к лог файлам,
      и не влияет на файл конфигурации (<option>-f</option>)
      или архивный каталог (<option>-a</option>).</para>

    <para>Утилита &man.newsyslog.8; теперь поддерживает параметр
      <option>-N</option>, запрещающий ротацию каких-либо файлов.</para>

    <para>Была добавлена переменная компиляции системы
      <literal>NO_NIS</literal>.  Как следует из ее имени, включение
      этой переменной приведет к исключению поддержки NIS из различных
      программ, и утилиты NIS не будут компилироваться. &merged;</para>

    <para>В течение многих лет, в &os; использовались
      переменные <filename>Makefile</filename> в формах
      <varname>NO<replaceable>FOO</replaceable></varname> и
      <varname>NO_<replaceable>FOO</replaceable></varname>.
      Теперь используются только переменные в форме
      <varname>NO_<replaceable>FOO</replaceable></varname>.
      Полный список таких переменных находится в файле
      <filename>/usr/share/mk/bsd.compat.mk</filename>; в нем
      также реализована временная обратная совместимость для
      старых имен.</para>

    <para>Проверка безопасности в &man.periodic.8; теперь поддерживает
      отображение счетчиков пакетов, заблокированных
      &man.pf.4;.  &merged;</para>

    <para>Была добавлена программа &man.powerd.8; для управления
      энергопотреблением.</para>

    <para>В программе &man.ppp.8; реализован параметр
      <option>echo</option>, позволяющий включать LCP ECHO
      независимо от LQR.  Более старые версии &man.ppp.8;
      переходят в режим LCP ECHO если согласование lqr
      не будет успешно проведено.  Теперь для получения
      такого поведения необходимо указать <command>enable
      echo</command>. &merged;</para>

    <para>В программу &man.ppp.8; были добавлены параметры
      <option>disable NAS-IP-Address</option> и
      <option>disable NAS-Identifier</option>,
      поддерживающие pre-RFC 2865 RADIUS серверы.</para>

    <para>Были исправлены две ошибки в программе &man.pppd.8;.
      Они могли привести к некорректному ответу CBCP,
      нарушающему Microsoft PPP Callback Control Protocol
      section 3.2.  &merged;</para>

    <para>Утилиты &man.rescue.8; в каталоге <filename>/rescue</filename>
      теперь включают &man.bsdtar.1; вместо GNU tar.</para>

    <para>Утилита &man.rm.1; теперь поддерживает параметр
      <option>-I</option>, с которым (однократно) запрашивается
      подтверждение при рекурсивном удалении каталогов или
      более 3 файлов, перечисленных в командной строке.
      &merged;</para>

    <para>Утилита &man.rm.1; теперь подавляет диагностические
      сообщения при попытке удаления несуществующего каталога,
      когда указаны параметры <option>-r</option> и
      <option>-f</option>.  Это поведение соответствует документу
      Version 3 of the Single UNIX Specification (SUSv3).</para>

    <para>Была добавлена библиотека &man.rpmatch.3; для проверки
      строки, содержащей положительный или отрицательный ответ
      в текущей локали.</para>

    <para>Динамический компоновщик &man.rtld.1; теперь поддерживает
      указание замещающих библиотек через переменную окружения
      <varname>LD_LIBMAP</varname>.  Эта переменная перезаписывает
      записи в &man.libmap.conf.5;. &merged;</para>

    <para>Нестандартный интерфейс поддержки мультибайтовых и расширенных
      символов rune(3) был удален.</para>

    <para>Функция &man.strftime.3; теперь поддерживает некоторые GNU
      расширения, такие как <literal>-</literal> (без заполнения),
      <literal>_</literal> (использовать пробел для заполнения),
      и <literal>0</literal> (заполнение нулями). &merged;</para>

    <para>Функцию &man.syslog.3; теперь можно безопасно использовать
      в многопоточных программах. &merged;</para>

    <para>Утилита &man.syslogd.8; теперь открывает дополнительный
      сокет (<filename>/var/run/logpriv</filename> по умолчанию),
      с правами <literal>0600</literal> для использования
      привилегированными программами.  Это предотвращает блокировку
      привилегированных программ, когда буфер сокета переполняется
      вследствие локальной DoS атаки. &merged;</para>

    <para>Утилита &man.syslogd.8; теперь позволяет использование
      символов <literal>:</literal> и <literal>%</literal> в
      имени хоста.  Эти символы используются в адресах и
      scope ID IPv6.</para>

    <para>&man.systat.1; <option>-netstat</option> теперь приспособлен
      для IPv6. &merged;</para>

    <para>Параметр <option>-f</option> утилиты &man.tail.1;
      теперь поддерживает более одного файла одновременно.
      &merged;</para>

    <para>Программы &man.telnet.1; и &man.telnetd.8; теперь поддерживают
      параметр <option>-S</option> для указания числового TOS
      байта.</para>

    <para>Предварение знаком <literal>+</literal> номера порта,
      передаваемого программе &man.telnet.1;, отключает распознавание
      параметров и позволяет передачу символов с установленным верхним
      битом.  Эта возможность предназначена для поддержки широко
      применяемого использования &man.telnet.1; для тестирования
      протокола.</para>

    <para>Была добавлена команда &man.tcpdrop.8;, закрывающая выбранное
      соединение TCP.  Она была заимствована из OpenBSD.</para>

    <para>&man.whois.1; теперь поддерживает флаг <option>-k</option>
      для запроса <hostid role="fqdn">whois.krnic.net</hostid>
      (the National Internet Development Agency of Korea),
      содержащего информацию о IP адресах в Корее. &merged;</para>

    <para>Параметр <option>-I</option> команды &man.xargs.1; был изменен
      для соответствия IEEE Std 1003.1-2004.  Стандарт требует, чтобы
      сконструированные аргументы не могли превышать 255 байт.</para>

    <para>Была исправлена ошибка чтения файлов конфигурации,
      таких как &man.hosts.5;, &man.services.5; и так далее, которые
      не заканчивались символом новой строки.</para>

    <sect3 id="rc-scripts">
      <title>Скрипты <filename>/etc/rc.d</filename></title>

      <para>&man.rc.conf.5; теперь поддерживает изменение имен
	сетевых интерфейсов во время загрузки. &merged;
        Например:</para>

      <programlisting>ifconfig_fxp0_name="net0"
ifconfig_net0="inet 10.0.0.1/16"</programlisting>

      <para>Скрипт <filename>rc.d/moused</filename> теперь может
	выполнять команды starts/stops/checks для определенного
	устройства, которое задается вторым аргументом к
	скрипту:</para>

      <screen>&prompt.root; /etc/rc.d/moused start ums0</screen>

      <para>Для использования различных переменных &man.rc.conf.5;
	с различными мышами, задавайте имя устройства в качестве
	части переменной.  Например, если устройство мыши
	<filename>/dev/ums0</filename>, можно использовать
	следующие строки:</para>

	<programlisting>moused_ums0_enable=yes
moused_ums0_flags="-z 4"
moused_ums0_port="/dev/ums0"</programlisting>

      <para>&man.rc.conf.5; теперь поддерживает переменные
	<varname>tmpmfs_flags</varname> и <varname>varmfs_flags</varname>.
	Они могут использоваться для передачи дополнительных параметров
	утилите &man.mdmfs.8;, задания &man.md.4; параметров создания
	файловой системы, таких как включение/выключение softupdates,
	указания владельца файловой системы по умолчанию и так далее.
	&merged;</para>

    </sect3>
  </sect2>

  <sect2 id="contrib">
    <title>Стороннее программное обеспечение</title>

    <para><application>FILE</application> был обновлен с 4.10
      до 4.12.</para>

    <para><application>GNU readline</application> был обновлен с
      версии 4.3 до версии 5.0.</para>

    <para><application>Heimdal</application> был обновлен с
      0.6.1 до 0.6.3. &merged;</para>

    <para><application>lukemftp</application> был обновлен с
      снэпшота из OpenBSD от 26 апреля 2004 года до снэпшота
      от 19 февраля 2005 года.</para>

    <para>Был добавлен снэпшот <application>netcat</application>
      из OpenBSD от 4 февраля 2005 года.  Более подробная информация
      находится на странице справки по &man.nc.1;. &merged;</para>

    <para><application>OpenPAM</application> был обновлен с релиза
      Eelgrass до релиза Feterita.</para>

    <para><application>OpenSSH</application> был обновлен с 3.8p1
      до 3.9p1.</para>

    <para><application>OpenSSL</application> был обновлен с
      0.9.7d до 0.9.7e. &merged;</para>

    <para><application>sendmail</application> был обновлен с
      версии 8.13.1 до версии 8.13.3. &merged;</para>

    <para>База данных timezone была обновлена с релиза
      <application>tzdata2004e</application> до релиза
      <application>tzdata2004g</application>. &merged;</para>

  </sect2>

  <sect2 id="ports">
    <title>Инфраструктура коллекции портов/пакетов</title>

    <para>Утилита &man.pkg.version.1; теперь поддерживает флаг
      <option>-q</option> для подавления вывода символов
      сравнения версий <literal>&lt;</literal>,
      <literal>=</literal> и <literal>&gt;</literal>.</para>

    <para>Файлы
      <filename>ports/INDEX<replaceable>*</replaceable></filename>,
      в которых находится индекс всех портов коллекции,
      был удален из репозитория CVS. &merged;
      Этот файл генерировался не часто, и следовательно обычно был
      устаревшим и не соответствовал состоянию портов.
      Пользователи, которым требуется индексный файл (например,
      для использования с такими программами, как &man.portupgrade.1;),
      могут получить копию двумя способами:</para>

    <itemizedlist>
      <listitem>
	<para>Создать индекс файл на основе текущего дерева портов,
	  выполнив <command>make index</command> из корневого каталога
	  дерева <filename>ports/</filename>.</para>
      </listitem>

      <listitem>
	<para>Забрать индексный файл по сети, выполнив
	  <command>make fetchindex</command> из корневого каталога
	  дерева <filename>ports/</filename>.  Этот индексный файл
	  (как правило) подходит для использования в течение дня.</para>
      </listitem>
    </itemizedlist>

  </sect2>

  <sect2 id="releng">
    <title>Подготовка релизов и интеграция</title>

    <para>В предыдущих релизах &os;, CD-ROM (или образ ISO)
      <filename>disc1</filename> был загрузочным установочным
      диском, содержащим основную систему, дерево портов
      и широко используемые пакеты.  CD-ROM (или образ ISO)
      <filename>disc2</filename> был загрузочным
      <quote>fix it</quote> диском с live filesystem, и был
      предназначен для восстановления после критических сбоев.
      Теперь для всех архитектур за исключением ia64, на
      <filename>disc1</filename> находится базовая система,
      дерево портов и live filesystem, что делает возможным
      как установку с этого диска, так и восстановление после
      сбоев.  (На ia64, live filesystem находится на отдельном
      диске, поскольку не умещается на первый).  Пакеты помещаются
      на отдельный диск. &merged;</para>

    <para>Поддерживаемая версия десктопа
      <application>GNOME</application> была обновлена с
      2.6.2 до 2.10. &merged;

      <note>
	<para>Пользователи предыдущих версий
	  <application>GNOME</application>
	  (<filename role="package">x11/gnome2</filename>)
	  должны подойти к обновлению с определенной осторожностью.
	  Простое обновление из коллекции портов &os; с помощью
	  &man.portupgrade.1;
	  (<filename role="package">sysutils/portupgrade</filename>)
	  вызовет серьезные проблемы.  Пользователи
	  <application>GNOME</application> должны внимательно прочесть
	  инструкции
	  <ulink url="&url.base;/gnome/docs/faq210.html"></ulink>
	  и использовать скрипт
	  <ulink url="&url.base;/gnome/gnome_upgrade.sh"><filename>gnome_upgrade.sh</filename></ulink>
	  для обновления до
	  <application>GNOME</application> 2.10.</para>

	<para>Для обновления библиотек
	  <application>GNOME</application>, достаточно
	  использовать &man.portupgrade.1;.</para></note>
      </para>

    <para>Поддерживаемая версия <application>KDE</application>
      была обновлена с 3.3.0 до 3.3.2. &merged;</para>

    <para>Поддерживаемая версия <application>Xorg</application> была
      обновлена с 6.7.0 до 6.8.1. &merged;</para>

  </sect2>

  <sect2 id="doc">
    <title>Документация</title>

    <para>Страницы справочника базовой системы получили множество
      исправлений, как в содержимом так и в отображении.
      Ссылки между страницами стали более корректными, стандартные
      заголовки разделов используются повсеместно, разметка была
      исправлена.</para>

    <para>Следующие страницы справочной системы, которые были получены
      из документов RFC, и возможно нарушали IETF копирайт, были замещены:
      &man.gai.strerror.3;,
      &man.getaddrinfo.3;,
      &man.getnameinfo.3;,
      &man.inet6.opt.init.3;,
      &man.inet6.option.space.3;,
      &man.inet6.rth.space.3;,
      &man.inet6.rthdr.space.3;,
      &man.icmp6.4; и
      &man.ip6.4;.</para>

  </sect2>

</sect1>

<sect1 id="upgrade">
  <title>Обновление с предыдущих релизов &os;</title>

  <para>Обновление из исходных текстов до &os; &release.current;
    теперь поддерживается только с &os; 5.3-RELEASE или более поздних.
    Пользователям более старых версий потребуется сначала обновить
    систему до &os; 5.3 или более свежей версии, а затем до
    &os; &release.current;.</para>

  <important>
    <para>Обновление &os; конечно же должно производиться только после
      резервного копирования <emphasis>всех</emphasis> данных и
      файлов настройки.</para>
  </important>
</sect1>

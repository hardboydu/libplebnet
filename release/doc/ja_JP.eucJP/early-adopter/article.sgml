<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % man PUBLIC "-//FreeBSD//ENTITIES DocBook Manual Page Entities//EN">
%man;

<!ENTITY % freebsd PUBLIC "-//FreeBSD//ENTITIES DocBook Miscellaneous FreeBSD Entities//EN">
%freebsd;

<!ENTITY % authors PUBLIC "-//FreeBSD//ENTITIES DocBook Author Entities//EN">
%authors;

<!ENTITY % ja-teams PUBLIC "-//FreeBSD//ENTITIES DocBook Team Entities//JA">
%ja-teams;

<!ENTITY % teams PUBLIC "-//FreeBSD//ENTITIES DocBook Team Entities//EN">
%teams;

<!ENTITY % ja-mailing-lists PUBLIC "-//FreeBSD//ENTITIES DocBook Mailing List Entities//JA">
%ja-mailing-lists;

<!ENTITY % release PUBLIC "-//FreeBSD//ENTITIES Release Specification//EN">
%release;
]>

<!--
    FreeBSD Japanese Documentation Project

    $FreeBSD$
    Original revision: 1.9
-->

<article>
  <articleinfo>
    <title>&os; 5.0-RELEASE 初期利用者のための手引き</title>

    <authorgroup>
      <corpauthor>&os; リリースエンジニアリングチーム</corpauthor>
    </authorgroup>

    <pubdate>$FreeBSD$</pubdate>

    <copyright>
      <year>2002</year>
      <year>2003</year>
      <holder role="mailto:re@FreeBSD.org">&os;
        リリースエンジニアリングチーム</holder>
    </copyright>
  </articleinfo>

  <sect1>
    <title>はじめに</title>

    <para>&os; 5.0 は、2 年ぶりに公開される新しいメジャーバージョンです。
      さまざまな新機能に加えて、システムアーキテクチャレベルでの開発も
      数多く反映されています。ただしこの進歩は、まだ広く試験されていない
      新しいコードが非常に多く導入された結果でもあります。
      そのため、現在の 4.<replaceable>X</replaceable> リリースと比較すると、
      5.0 は安定性や性能、場合によっては機能性などの点で劣っているかも知れません。</para>

    <para>&a.re; はこのような理由から、何も考えずに古い
      &os; リリースを 5.0 にアップグレードするのは<emphasis>おすすめしません</emphasis>。
      今までどおりの動作を期待するユーザには特に、当分の間は
      4.<replaceable>X</replaceable> リリース (4.7-RELEASE や次回公開予定の
      4.8-RELEASE など) の利用をおすすめします。そのようなユーザが
      5.<replaceable>X</replaceable> へのアップグレードを考える時期としては、
      おそらく 5-STABLE 開発ブランチが作成された後が適当でしょう。
      これは 5.1-RELEASE か 5.2-RELEASE の公開あたりになる見込みです。</para>

    <para>(&os; 5.0 はいわゆる<quote>卵鶏問題</quote>を抱えています。
      プロジェクトでは皆が可能な限り 5.0-RELEASE
      を安定で信頼性の高いものにしようと考えているのですが、
      その安定性と信頼性を得るには、広い範囲での試験、
      特にシステムの新しい機能に対する試験が必要です。
      しかし、たくさんのユーザにシステムを試験してもらうためには、
      実際のところ最初のリリースを作成し、
      配布しなければならないのです!)</para>

    <para>この文書では、&os; 5.0-RELEASE のインストールと運用における
      いくつかの問題点について説明しています。
      まず、&os; のリリース工程の概要について解説し、
      次に &os; 5.0 の特筆すべき新機能のいくつかと、
      不注意からユーザが陥りやすいと思われる問題について紹介します。
      また、4-STABLE ベースのリリースを使い続けようと考えているユーザ向けに、
      今後の 4-STABLE 開発ブランチにおける短期・中期的なプランについても触れます。
      最後に、4.<replaceable>X</replaceable> システムを 5.0
      にアップグレードする際の注意点を示します。</para>
  </sect1>

  <sect1>
    <title>&os; リリース工程の概要</title>

    <para>&os; では、ソースコードリポジトリに複数の開発ブランチを置く
      という開発モデルを採用しています。中心となるブランチは
      <quote>CURRENT</quote> と呼ばれ、
      CVS リポジトリでは <literal>HEAD</literal> というタグが付けられています。
      新機能はまず、このブランチにコミットされます。
      つまり CURRENT には新機能が一番最初に追加されますが、
      その新機能の追加やデバッグが原因でシステムが壊れてしまうこともある、
      ということです。</para>

    <para>&os; リリースの大部分は、いくつかある <quote>STABLE</quote>
      ブランチから作成されます。これらのブランチには、CURRENT
      である程度試験された機能だけが追加されます。
      現時点で活発に開発されている STABLE ブランチは 1 つだけです。
      そのブランチは <quote>4-STABLE</quote> と呼ばれており、
      &os; 4.<replaceable>X</replaceable>
      リリースはすべてこのブランチから作成されました。     
      このブランチは CVS リポジトリで
      <literal>RELENG_4</literal> というタグが付けられています。</para>

    <para>&os; 5.0 は CURRENT ブランチをベースにしています。
      CURRENT ブランチからのリリースは 2 年ぶりです
      (前回の &os; 4.0 は 2000 年 3 月でした)。</para>

    <para>&os; 5.0 のリリース後、少し経過した時点で
      &os; CVS リポジトリに <literal>RELENG_5</literal> というタグが打たれ、
      <quote>5-STABLE</quote> というブランチが作成される予定です。
      以前の 2 つの stable ブランチ (3-STABLE および 4-STABLE) は、
      それぞれの <quote>x.0</quote> リリースの直後 (それぞれ 3.0 と 4.0) に
      作成されていました。しかしこの方法では、
      新しい STABLE ブランチが作成されてから、
      CURRENT ブランチとその新しいブランチが安定するまでに
      十分な時間が確保できないという問題があります。</para>

    <para>そのためリリースエンジニアリングチームは、
      各ブランチがそのブランチの持つ性格に対して
      比較的安定した状態になったことを確認してから、
      CVS リポジトリに 5-STABLE ブランチを作成することを予定しています。
      おそらくブランチが作成されるまでに、5.<replaceable>X</replaceable>
      系列からリリース版がいくつか公開されるでしょう。
      5-STABLE ブランチの登場は、5.1-RELEASE か 5.2-RELEASE
      の後あたりになると見込んでいます。</para>

    <para>&os; リリースエンジニアリング工程に関する詳細は、
      <ulink url="http://www.FreeBSD.org/releng/index.html">リリースエンジニアリングのウェブページ</ulink>
      および、&os; に含まれている<ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/articles/releng/index.html">リリースエンジニアリング</ulink>という記事をご覧ください。</para>

  </sect1>

  <sect1>
    <title>新機能</title>

    <para>&os; 5.0 の大きな魅力の 1 つは、数多くの新機能です。
      これらの新しい機能は、&os; 4-STABLE 開発ブランチには統合できなかった
      大きなアーキテクチャレベルの変更も当然ながら含まれています
      (一方で新しいデバイスドライバやユーザランドユーティリティなど、
      それ自身で完結している改良点は、4-STABLE ブランチに移植されています)。
      すべてを網羅したものではありませんが、簡単にまとめてみましょう。</para>

    <itemizedlist>
      <listitem>
        <para>SMPng: <quote>次世代</quote>に向けた SMP マシン対応です (開発中)。
          現在は、カーネルにおけるマルチプロセッサの同時実行に部分的に対応しています。</para>
      </listitem>

      <listitem>
	<para>KSE:  カーネルスケジュールエンティティ
          (Kernel Scheduled Entities; KSE) は、スケジューラアクティベーション
          (Scheduler Activations) の手法と同様の、
          1 個のプロセスが複数のカーネルレベルスレッドを
          持てるようにするための機構です。</para>
      </listitem>

      <listitem>
	<para>新しいアーキテクチャ:  i386, pc98, alpha アーキテクチャに加え、
          新たに sparc64 と ia64 アーキテクチャに対応しました。</para>
      </listitem>

      <listitem>
	<para>GCC:  コンパイラツールチェインが
	  GCC 2.95.<replaceable>X</replaceable> ベースのものから、
          GCC 3.2.1 pre-release スナップショットベースのものに更新されました。</para>
      </listitem>

      <listitem>
	<para>MAC:  高い拡張性を持ち動的にロード可能な、
          強制アクセス制御 (Mandatory Access Control; MAC)
          ポリシに対応しました。</para>
      </listitem>

      <listitem>
        <para>GEOM:  ディスク I/O 要求を変換する拡張性の高いフレームワークです。
          GEOM をベースにしたディスク暗号化機能が実験的に開発されています。</para>
      </listitem>

      <listitem>
	<para>FFS: FFS ファイルシステムが (クラッシュから高速に復帰する)
          バックグラウンド &man.fsck.8; 処理 と
          ファイルシステムスナップショットに対応しました。</para>
      </listitem>

      <listitem>
	<para>UFS2:  UFS2 オンディスクフォーマットが新たに追加されました。
          これは、ファイル単位での拡張属性と巨大なファイルに対応しています。</para>
      </listitem>

      <listitem>
        <para>Cardbus:  Cardbus デバイスに対応しました。</para>
      </listitem>

    </itemizedlist>

    <para>さらに詳しい新機能のリストは、&os; 5.0
      のリリースノートに書かれています。</para>
  </sect1>

  <sect1>
    <title>初期リリースを使う上での欠点</title>

    <para>&os; 5.0 には説明したような新機能が追加されているのですが、
      問題があったり、意図どおりに動かないという部分もいくつか存在します。
      これはほとんどの場合、多くの機能がまだ開発中であることに起因したものです。
      次に、問題のある部分のいくつかをまとめたリストを示します。</para>

    <itemizedlist>

      <listitem>
        <para>たとえば、上の新機能リストにある SMPng や KSE など、
          開発がまだ終わっていない機能が多くあります。</para>
      </listitem>

      <listitem>
        <para>カーネルのデータ構造体や ABI, API が変更されたため、
          サードパーティ製のデバイスドライバは、
          &os; 5.0 に対応させるための作業が必要です。
          また、5-STABLE ブランチが作成される前に若干の
          ABI, API の変更が加えられる可能性があります。</para>
      </listitem>

      <listitem>
        <para>&os; ベースシステムに含まれていた機能のいくつかが、
          Ports Collection に移動しました。
          大きなものとしては、<application>Perl</application>、
          <application>UUCP</application>、ゲームの大部分
          (すべてではありません) が該当します。
          プログラムはサポート対象になっていますが、
          ベースシステムからなくなったことは混乱を招くかも知れません。</para>
      </listitem>

      <listitem>
        <para>&os; 4.0 で正しく動作していた多くの ports/packages が、
          &os; 5.0 では構築できなくなったり、
          正しく動作しなくなったりしています。
          これは大抵の場合、コンパイラツールチェインの変更と、
          ヘッダファイルの整頓が原因です。</para>
      </listitem>

      <listitem>
        <para>&os; 5.0 は CURRENT から 2 年ぶりにリリースされたものです。
          これはその多くの新機能が、一般向けに広く公開される初めての機会になります。
          カーネルは、(SMPng などの) このような新機能によって、
          大きく変更されています。</para>
      </listitem>

      <listitem>
        <para>&os; 5.0 の新機能に含まれる問題点を追跡するため、
          デバッグや診断用のコードがある程度残されています。
          これにより &os; 5.0 は、4-STABLE より動作が遅くなっているでしょう。</para>
      </listitem>

      <listitem>
        <para>4-STABLE 開発ブランチへの機能統合は、
          -CURRENT で<quote>安定した</quote>後にのみ、行なわれます。
          &os; 5.0 は、このような -STABLE ブランチの持つ安定性を持っていません
          (訳注: &os; 5.0 への新機能追加は、「安定した後に統合」という
          -STABLE ブランチの慣習に則っていないという意味です)。
          (5-STABLE 開発ブランチは、5.1-RELEASE もしくは 5.2-RELEASE
          の後あたりに作成される予定です)。</para>
      </listitem>

      <listitem>
        <para>&os; <ulink
          url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/index.html">ハンドブック</ulink>
        と <ulink
          url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/faq/index.html">FAQ</ulink>
        のような文書は &os; 5.0
        までに加えられた最近の変更を反映していないかもしれません。</para>
      </listitem>

    </itemizedlist>

    <para>このようにシステムの安定性に影響する欠点が多くあることから、
      5.<replaceable>X</replaceable> 系列が十分に安定するまでの間、
      リリースエンジニアリングチームは、
      現在の機能性・安定性を重要視するサイトやユーザに対して
      4-STABLE ブランチから公開されるリリース版を利用することを推奨しています。</para>
  </sect1>

  <sect1>
    <title>4-STABLE ブランチに対する今後の予定</title>

    <para>&os; 5.0 が公開されても、4-STABLE ブランチの開発が終了するわけではありません。
      このブランチからは少なくとも 1 回、4.8-RELEASE が公開されます。
      4.8-RELEASE の公開は、現時点では 2003 年 2 月 1 日の予定です。</para>

    <para>執筆時点では、リリースエンジニアリングチームは
      4-STABLE ブランチからの (4.8 以降の) リリースの公開について、
      はっきりとした計画を持っていません。ただし、4.9-RELEASE、あるいは
      4.10-RELEASE の公開は十分にありえます。4-STABLE ブランチからの
      将来のリリースは、いくつかの要素が絡んできます。
      最も重要なのは、5-STABLE ブランチの作成と、その安定性です。
      CURRENT が 5-STABLE ブランチを作成できるほどに安定していなかった場合、
      リリースは 4-STABLE ブランチから作成することになるでしょう。
      また 4-STABLE には、4-STABLE ブランチからの最終リリースが
      告知されるまで、開発者の判断とリリースエンジニアリングの
      ポリシに基づいて HEAD から新機能が統合されます。</para>

    <para>ある程度ですが、リリースエンジニアリングチームは、
      将来の 4-STABLE リリースに対するユーザのニーズを考慮するつもりです。
      ただしそのニーズは、リリースエンジニアリング作業に必要な労力・資源
      (人的資源、計算機資源、ミラーアーカイブ容量)
      に見合ったものである必要があるでしょう。</para>

    <para>&a.security-officer; は &os; ウェブサイトの
      <ulink url="http://www.FreeBSD.org/security/index.html">セキュリティのページ</ulink>
      で公開されているポリシに基づき、
      4-STABLE ブランチから作成されるリリースのサポートを継続します。
      セキュリティ勧告とセキュリティ上の修正がサポートするのは、
      通常、各ブランチ毎に最も新しい 2 つのリリースです。
      セキュリティオフィサチームは、
      他のリリース版もこのルールに則ったサポートを行ないます。</para>
  </sect1>

  <sect1>
    <title>アップグレードの際の注意点</title>

    <para>この節では現在 &os; システムを利用している方向けに、
      &os; 4.<replaceable>X</replaceable> システムを
      5.<replaceable>X</replaceable> システムにアップグレードする際の
      注意点について説明します。
      &os; をアップグレードする場合は、アップグレードしたいバージョンの
      リリースノートと errata 文書を読むこと、また、
      ソースからアップグレードする場合には
      <filename>src/UPDATING</filename> を読むことが重要です。</para>

    <sect2>
      <title>バイナリアップグレード</title>

      <para>おそらく最も単純な方法は、
        <quote>すべてをバックアップして、再フォーマット、再インストールし、
          最後にバックアップを展開</quote>することでしょう。
        この方法は、互換性がなかったり、古くて使えない実行ファイルや
        設定ファイルによって、新しいシステムが汚染される問題を回避することができます。</para>

      <para>現時点の &man.sysinstall.8; のバイナリアップグレード機能は、
        メジャーバージョンをまたぐアップグレードに対して
        十分に試験されていません。
        そのため、この機能を使うことはおすすめできません。
        特に、バイナリアップグレードは
        &os; 4.<replaceable>X</replaceable> に存在して
        &os 5.0 に存在しないファイルをシステムに数多く残します。
        これらの古いファイルは何らかの問題を引き起こす可能性があります。</para>

      <para>i386 および pc98 プラットフォームの 4-STABLE では、
        インストールメディアからの起動の際、
        ISA デバイスの設定を起動時に変更できる UserConfig
        ユーティリティが利用できるようになっています。
        &os; 5.0 では、この機能の一部が &man.device.hints.5; 機構に
        置き換えられました(同じパラメータを指定できますが、
        対話的なものではなくなっています)。</para>

      <para>フロッピを使ったバイナリインストールには、
        デバイスドライバのカーネルモジュールを含んだ
        新しい 3 枚目のフロッピイメージが必要です。
        この <filename>drivers.flp</filename> フロッピイメージは通常、
        従来からある <filename>kern.flp</filename> や
        <filename>mfsroot.flp</filename>
        のフロッピイメージが置かれている場所と同じところに置かれています。</para>

      <para>i386 アーキテクチャにおける CDROM を使ったインストールでは、
        <quote>非エミュレーション型</quote>の起動ローダを使用するようになっています。
        この利点はいろいろとありますが、フロッピイメージ用に切り詰めた
        カーネルではなく、通常の <literal>GENERIC</literal> カーネルが
        使用できるという点があげられるでしょう。
        理論的には、Microsoft Windows NT 4 インストール CDROM
        が起動できるシステムなら、&os; 5.0 CDROM も動作するはずです。</para>
    </sect2>

    <sect2>
      <title>ソースを使ったアップグレード</title>

      <para>何はともあれ、<filename>src/UPDATING</filename>
        を読むことが非常に大切です。
        <quote>To upgrade from 4.x-stable to current</quote>
        という節には、アップグレード手順がステップバイステップで書かれています。
        説明されているとおり、正確に従ってください。
        たまにやる人がいるのですが、
        手順を<quote>飛ばしたり</quote>してはいけません。</para>
    </sect2>

    <sect2>
      <title>共通の注意点</title>

      <para><application>Perl</application>
        がベースシステムから削除されています。
        すでに作成ずみの package から、もしくは Ports Collection から
        Perl をインストールするのがおすすめです。
        以前は Perl をベースシステムの一部として構築していたため、
        Perl のアップグレードが難しく、多くの問題を引き起こしていました。
        ベースシステムのユーティリティで Perl を使うものは、
        まだ使われているものは Perl を使わないものに書き換えられ、
        使わなくなったものは削除されています。</para>

      <para>スクリプトの中には、Perl インタプリタが
        <filename>/usr/bin/perl</filename> に存在することを想定しているものがあります。
        Perl の port に含まれる <filename>use.perl</filename> コマンドを使うと、
        そういったスクリプトが動作できるよう、
        シンボリックリンクを適切に作成することが可能です。
        ほとんどの場合は <command>use.perl port</command>
        を実行するだけで、必要な設定をしてくれるでしょう。</para>

      <para>基本的に、従来の 4.<replaceable>X</replaceable>
        で使っていた実行ファイルは 5.<replaceable>X</replaceable> でも動作します。
        ただし、これには
        <filename>compat4x</filename> 配布物がインストールされていることが必要です。
        つまり、古い ports を使うことは<emphasis>おそらく</emphasis>可能です。</para>

      <para>既存の 4-STABLE ベースのシステムに上書きする形でインストールや
        アップグレードを行なった場合は、
        <filename>/usr/include</filename>
        にある古いヘッダファイルを削除することが非常に重要です。
        バイナリインストールや <literal>installworld</literal> の前に、
        このディレクトリをリネームしておくと良いでしょう。
        こうしないと、(特に C++ プログラムで) コンパイラが古いヘッダと
        新しいヘッダを混ぜて使用してしまい、おかしな結果になる可能性があります。</para>
    </sect2>
  </sect1>

  <sect1>
    <title>まとめ</title>

    <para>&os; 5.0 には魅力的な機能がたくさん含まれています。
      しかし現時点では、それがすべての皆さんの期待に応えられるものではないかも知れません。
      この文書では、リリースエンジニアリングの背景と
      5.<replaceable>X</replaceable> 系列の特筆すべき新機能の一部について、
      初期リリースを使う上でのいくつかの欠点についてとりあげました。
      また、将来の 4-STABLE 開発ブランチの計画と、
      初期リリースを利用する人向けのアップグレードのヒントも説明しています。</para>
  </sect1>
</article>
